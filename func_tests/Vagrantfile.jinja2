# -*- mode: ruby -*-
# vi: set ft=ruby :

# This file is generated from {{ template_fpath }}. Don't edit manually, your changes may be lost!


Vagrant.configure("2") do |config|
  config.vm.box_url = "http://noptix.enk.me/vagrant-boxes/ubuntu-14-04-functest-20160906.box"
  config.vm.box = "autotest"
  config.vm.network :private_network, type: :dhcp
  config.ssh.forward_agent = true

  config.vm.provider :virtualbox do |vb|
    vb.memory = 512
    vb.cpus = 1
    vb.gui = false
    vb.customize ["modifyvm", :id, "--cpuexecutioncap", "75"]
    vb.customize ["modifyvm", :id, "--ioapic", "on"]
    vb.customize ["modifyvm", :id, "--vram", "32"]
  end

  {% for box in boxes -%}

  config.vm.define "{{ box.name }}" do |box|
    box.vm.provider :virtualbox do |vb|
      vb.customize ["modifyvm", :id, "--name", "{{ box.name }}"]
      vb.customize ["setextradata", :id, "VBoxInternal/Devices/VMMDev/0/Config/GetHostTimeDisabled", 1]
    end
    #box.vm.synced_folder "mediaserver-default", "/opt/networkoptix", owner: "root", group: "root"
    box.vm.hostname = "{{ box.name }}"
    box.vm.network :forwarded_port, guest: 7001, host: {{ box.forwarded_port }}
    box.vm.provision :shell, inline: "sudo DEBIAN_FRONTEND=noninteractive dpkg -i --force-depends /vagrant/networkoptix-mediaserver.deb"
  end

  {% endfor %}

end
