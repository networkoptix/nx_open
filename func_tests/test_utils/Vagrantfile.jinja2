# -*- mode: ruby -*-
# vi: set ft=ruby :

# This file is generated from {{ template_file_path }}. Don't edit manually, your changes may be lost!


Vagrant.configure("2") do |config|

  config.vm.box = "ubuntu/trusty64"
  config.ssh.forward_agent = true
  config.ssh.insert_key = false

  config.vm.provider :virtualbox do |vb|
    vb.memory = 512
    vb.cpus = 1
    vb.customize [:modifyvm, :id, "--cpuexecutioncap", "75"]
    vb.customize [:modifyvm, :id, "--ioapic", "on"]
    vb.customize [:modifyvm, :id, "--vram", "32"]
    # network created by virtualbox by default conflicts with nx moscow local network 10.0.2.0/23; natnet1 will override it
    vb.customize [:modifyvm, :id, "--natnet1", "{{ natnet1 }}"]
  end


  {% for vm in vms -%}

  config.vm.define "{{ vm.vagrant_name }}" do |node|

    node.vm.provider :virtualbox do |vb|
      vb.name = "{{ vm.virtualbox_name }}"

      {%- for command in vm.virtualbox_conf %}

      vb.{{ command }}

      {%- endfor %}
    end

    node.vm.hostname = "{{ vm.vagrant_name }}"
    # Uncomment it to provide access to a node by forwarding ssh port
    # node.vm.network :forwarded_port, guest: 22, host: {{ vm.ssh_forwarded_port }},  host_ip: "0.0.0.0", id: "ssh", auto_correct: true
    node.vm.network :forwarded_port, guest: {{ vm.rest_api_internal_port }}, host: {{ vm.rest_api_forwarded_port }}

    {% for command in vm.vagrant_conf -%}

    node.{{ command }}

    {% endfor %}
  
  end

  {% endfor %}

end
