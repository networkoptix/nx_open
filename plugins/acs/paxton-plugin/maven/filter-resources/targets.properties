<?xml version="1.0" encoding="utf-8"?>
<Project ToolsVersion="4.0" DefaultTargets="Build" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Target Name="AfterBuild">
    <PropertyGroup>
      <ReferenceAssemblies>C:\Program Files (x86)\Reference Assemblies\Microsoft\Framework\.NETFramework\v4.0</ReferenceAssemblies>
      <ILMergePath>$(ProjectDir)packages\ilmerge.2.14.1208\tools\ILMerge.exe</ILMergePath>
      <SignKey>$(ProjectDir)Sign.snk</SignKey>
    </PropertyGroup>
    <CreateItem Include="@(ReferenceCopyLocalPaths)" Condition="'%(CopyLocal)'=='true' AND '%(Extension)'=='.dll'">
      <Output TaskParameter="Include" ItemName="AssembliesToMerge" />
    </CreateItem>
    <Exec Command="&quot;$(ILMergePath)&quot; /keyfile:$(SignKey) /target:library /out:${paxton.className}.OemDvrMiniDriver.Merged.dll ${paxton.className}.OemDvrMiniDriver.dll Newtonsoft.Json.dll" WorkingDirectory="$(OutputPath)" />
    <Delete Files="@(ReferenceCopyLocalPaths->'$(OutDir)%(DestinationSubDirectory)%(Filename)%(Extension)')" />
    <Delete Files="$(OutputPath)\${paxton.className}.OemDvrMiniDriver.dll" />
    <Delete Files="$(OutputPath)\${paxton.className}.OemDvrMiniDriver.pdb" />
  </Target>
</Project>
