# Classes constructing Timeline Area {#timeline}

// Copyright 2018-present Network Optix, Inc. Licensed under MPL 2.0: www.mozilla.org/MPL/2.0/

These classes construct the lower part on the VMS Client area.

![image](doc/timeline.png)

### Todo
Most of classes here are ancient and need refactoring and coding style upgrade. It is also suggested to move them (except *html_text_item* and probably *control_background_widget*) to some more specific source tree position.

## QnNavigationItem
The main class managing all of the bottom area. The central widget with the timeline is managed by **QnTimeSlider**.

## QnTimeSlider
The main class that manages the central part of the navigation widget.
### Todo
This is one of the biggest vms units, 3500+ lines of code. It should be refactored.

## QnTimeStep
Represents time labels on the timeline.
**toShortString()** is used for the time label below the ticks (both smaller and larger), and
**toLongString()** is used for the upper time labels in the rectangles.

## QnSpeedSlider
Shows the speed slider on the left.

## QnVolumeSlider
Shows the volume slider on the left.

## QnTimeSliderPixmapCache
Caches the text-containing bitmaps for the Timeline. There are two caches - one is for
the date-times below the tick-marks, accessible via **tickmarkTextPixmap()**, and another one, accessible via **dateTextPixmap()** for the dates above the tick-marks.
### Internals
There are two internal caches, **m_pixmapByShortPositionKey** (256Mb) is for the tick-marks, and
**m_pixmapByLongPositionKey** (64Mb) for the dates above the tick-marks.

**m_pixmapByShortPositionKey** is multi-leveled (4 levels) for ticks of different order and indexed by 32-bit integers generated by **shortCacheKey()** from *time_step* module using timestamp, height and some additional info from **QnTimeStep**.

**m_pixmapByLongPositionKey** is indexed by a pair of 64-bit integers (**QnTimeStepLongCacheKey**)
that are provided by **longCacheKey* from *time_step*.
Internally both caches are filled using the global QnTextPixmapCache instance.
### Todo
Some public members should be made private.

## QnTimeScrollBar
Custom-drawn scrollbar, the lowest part of the timeline. The handle grip is custom-drawn and mouse
clicks are specifically handled. Also shows the indicator for the current time position.
### Todo
Rename **ensurePixmap()**, move **paint()** to private.

## QnBookmarksViewer
![image](doc/bookmark.png)

Shows one stack of Bookmarks in the defined position.
### Todo
Needs a coding style upgrade.

## QnClockLabel
Simple class to show the clock in the lower-left corner of the VMS window.

## QnHtmlTextItem
General graphic widget to display rich HTML text with customizations.
### Todo
Needs a coding style upgrade. Should be moved - it is inconsistently placed.

## QnControlBackgroundWidget
General graphic base widget to display a frame and a gradient fill for the main panels (resources and notifications).
### Todo
Needs a coding style upgrade. Should be moved - it is inconsistently placed.

## QnBookmarkTagsControl
A widget that is used by **QnBookmarksViewer** to show Bookmark tags.
### Todo
Needs a coding style upgrade.
