#include <nx/kit/test.h>

#include <map>
#include <string>

#include <plugins/plugin_api.h>
#include <plugins/plugin_tools.h>

TEST(NxGuidHelper, fromString)
{
    const std::map<std::string, nxpl::NX_GUID> goodGuids = {
        {
            "{b6565a87-5897-43b4-8f1a-ea1778a65ed1}",
            {{0xb6,0x56,0x5a,0x87,0x58,0x97,0x43,0xb4,0x8f,0x1a,0xea,0x17,0x78,0xa6,0x5e,0xd1}}
        },
        {
            "1be1f39b-96a6-481a-aa63-b4886314ad65",
            {{0x1b,0xe1,0xf3,0x9b,0x96,0xa6,0x48,0x1a,0xaa,0x63,0xb4,0x88,0x63,0x14,0xad,0x65}}
        },
        {
            "4b47b06f76fd4f76b58df88a303de631",
            {{0x4b,0x47,0xb0,0x6f,0x76,0xfd,0x4f,0x76,0xb5,0x8d,0xf8,0x8a,0x30,0x3d,0xe6,0x31}}
        },
        {
            "D7BFE5822B844E26AAAA40DA5CA5F097",
            {{0xd7,0xbf,0xe5,0x82,0x2b,0x84,0x4e,0x26,0xaa,0xaa,0x40,0xda,0x5c,0xa5,0xf0,0x97}}
        },
        {
            "C9560F62-EC0D-45E9-B2A5-190A9F76B778",
            {{0xc9,0x56,0x0f,0x62,0xec,0x0d,0x45,0xe9,0xb2,0xa5,0x19,0x0a,0x9f,0x76,0xb7,0x78}}
        },
        {
            "{D4BB55A4-A87A-4199-BBD1-8000A480A5AD}",
            {{0xd4,0xbb,0x55,0xa4,0xa8,0x7a,0x41,0x99,0xbb,0xd1,0x80,0x00,0xa4,0x80,0xa5,0xad}}
        },
        {
            "   {D3BB55A4-A87A-4199-BBD1-8000A4  80A5AD}   ",
            {{0xd3,0xbb,0x55,0xa4,0xa8,0x7a,0x41,0x99,0xbb,0xd1,0x80,0x00,0xa4,0x80,0xa5,0xad}}
        },
    };

    const std::vector<std::string> badGuids = {
        "{asdadsjhgjhg",
        "C9560F62-EC0D-45E9-B2A5-190A9F76B778adadae",
        "D7BFE5822B844E26AAAA40DA5CA5R097",
        "<1be1f39b-96a6-481a-aa63-b4886314ad65>"
    };

    for (const auto& entry: goodGuids)
    {
        ASSERT_EQ(nxpt::NxGuidHelper::fromStdString(entry.first), entry.second);
    }

    for (const auto& guidStr: badGuids)
    {
        ASSERT_EQ(nxpt::NxGuidHelper::fromStdString(guidStr), nxpt::NxGuidHelper::nullGuid());
    }
}
