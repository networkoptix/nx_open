<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi" xmlns:util="http://schemas.microsoft.com/wix/UtilExtension"
     xmlns:fire="http://schemas.microsoft.com/wix/FirewallExtension">
  <Product Id="*" Name="$(env.APPLICATION_NAME)" Language="1033" Version="$(env.APPLICATION_VERSION)" Manufacturer="$(env.ORGANIZATION_NAME)" UpgradeCode="CE572797-45BF-4f1c-A783-369EA79C597E">
    <Package Id="*" InstallerVersion="300" Compressed="yes" Keywords="Installer" Comments="$(env.ORGANIZATION_NAME) $(env.APPLICATION_NAME)(beta) Installer" Manufacturer="$(env.ORGANIZATION_NAME)" InstallPrivileges="elevated"/>

    <?ifdef env.CommonProgramFiles(x86) ?>
    <!-- Variable is defined, we are building on 64 bit -->
      <?define commonProgramFiles = "c:\Program Files (x86)\Common Files\" ?>
    <?else?>
    <!-- Variable is not defined, we are building on 32 bit -->
      <?define commonProgramFiles = "c:\Program Files\Common Files\" ?>
    <?endif?>

    <WixVariable Id="WixUILicenseRtf" Value="License.rtf" />
    <WixVariable Id="WixUIBannerBmp" Value="Binary\eve\eve_logo-493x58.bmp" />
    <WixVariable Id="WixUIDialogBmp" Value="Binary\eve\eve_logo-493x312.bmp" />
      <Property Id="WelcomeDlg_Title" Value="$(env.APPLICATION_NAME)(beta) Setup" />

    <Icon Id="eve_logo.ico" SourceFile="Binary\eve\eve_logo.ico"/>
    <Property Id="ARPPRODUCTICON" Value="eve_logo.ico" />

    <Property Id="NEWERFOUND" Secure="yes"/>
    <Property Id="ALLUSERS" Secure="yes"/>
    <Property Id="PREVIOUSVERSIONSINSTALLED" Secure="yes" />
    <Property Id="LAUNCHAPPONEXIT" Secure="yes" />
    <Property Id="WIXUI_EXITDIALOGOPTIONALCHECKBOXTEXT" Value="Launch $(env.APPLICATION_NAME) when setup exits."  />
    <Property Id="MEDIAFOLDER" Secure="yes" />
<!--    <PropertyRef Id="FILETYPES"/> -->

    <!--[%LocalAppData]-->
    <Property Id="XMLSETTINGS" Value="%LocalAppData%\$(env.ORGANIZATION_NAME)\$(env.APPLICATION_NAME)\settings.xml" />
    
<!-- Custom actions for saving/restoring file associations.
    
    <Binary Id="FILEASSOCBACKUP" SourceFile="FileAssociationsBackup.js"/>
    <CustomAction Id="FileAssocBackup" BinaryKey="FILEASSOCBACKUP" JScriptCall="PreserveFileAssociations" Execute="deferred" Impersonate="no" Win64="no"/>
    
    <Binary Id="FILEASSOCRESTORE" SourceFile="FileAssociationsRestore.js"/>
    <CustomAction Id="FileAssocRestore" BinaryKey="FILEASSOCRESTORE" JScriptCall="RestoreFileAssociations" Execute="deferred" Impersonate="no" Win64="no"/> 
-->

    <Binary Id="PropsCA.dll" SourceFile="PropsCA\Release\PropsCA.dll" />
    <Binary Id="EveAssocCA.dll" SourceFile="EveAssocCA\Release\EveAssocCA.dll" />

    <CustomAction Id="SetMoviesFolder" BinaryKey="PropsCA.dll" DllEntry="SetMoviesFolder" />
    <CustomAction Id="SetProperties" BinaryKey="PropsCA.dll" DllEntry="SetProperties" Execute="firstSequence" />

    <Upgrade Id="CE572797-45BF-4f1c-A783-369EA79C597E">
      <UpgradeVersion
         Minimum="0.1.0" Maximum="$(env.APPLICATION_VERSION)"
         Property="PREVIOUSVERSIONSINSTALLED"
         IncludeMinimum="yes" IncludeMaximum="yes" />
      <UpgradeVersion OnlyDetect='no' Property='NEWERFOUND' Minimum='$(env.APPLICATION_VERSION)' IncludeMinimum='no' />
    </Upgrade>

    <CustomAction Id="AssignMediaFolder" Property="MEDIAFOLDER" Value="[MOVIESFOLDER]\EVE Media" />
    <CustomAction Id="ResetMediaFolder" Property="MEDIAFOLDER" Value="" />
    <CustomAction Id="StartAppOnExit" FileKey="UniclientEXE" ExeCommand="" Execute="immediate" Impersonate="yes" Return="asyncNoWait"/>
    
<!--    <CustomAction Id="SaveAssociations" BinaryKey="EveAssocCA.dll" DllEntry="SaveAssociations" Execute="deferred"/>
    <CustomAction Id="SaveAssociations.SetProperty" Return="check" Property="SaveAssociations" Value="[FILETYPES]"/>

    <CustomAction Id="RestoreAssociations" BinaryKey="EveAssocCA.dll" DllEntry="RestoreAssociations" Execute="deferred"/>
    <CustomAction Id="RestoreAssociations.SetProperty" Return="check" Property="RestoreAssociations" Value="[FILETYPES]"/> -->
    
    <InstallUISequence>
      <Custom Action="SetProperties" Before="SetMoviesFolder" />
      <Custom Action="SetMoviesFolder" Before="AssignMediaFolder" />
      <Custom Action="AssignMediaFolder" Before="CostInitialize">MEDIAFOLDER=""</Custom>

      <Custom Action="ResetMediaFolder" Before="CostFinalize">Installed AND NOT UPGRADINGPRODUCTCODE</Custom>
      <!--<Custom Action='DowngradeWarning' After='FindRelatedProducts'>NEWERFOUND</Custom>-->
      <!--<Show Dialog="OsWarningDlg" Before="WelcomeDlg">NEWERFOUND</Show>-->
      <!--<Show Dialog="DowngradeWarningDlg" Before="WelcomeDlg">NEWERFOUND</Show>-->
    </InstallUISequence>

    <InstallExecuteSequence>
      <RemoveExistingProducts Before="InstallInitialize" />

<!--      <Custom Action="SaveAssociations.SetProperty" After="WriteRegistryValues">NOT Installed</Custom>
      <Custom Action="SaveAssociations" After="SaveAssociations.SetProperty">NOT Installed</Custom>

      <Custom Action="RestoreAssociations.SetProperty" Before="RestoreAssociations">Installed AND NOT UPGRADINGPRODUCTCODE</Custom>
      <Custom Action="RestoreAssociations" Before="RemoveRegistryValues">Installed AND NOT UPGRADINGPRODUCTCODE</Custom> -->
    </InstallExecuteSequence>

    <Media Id="1" Cabinet="media1.cab" EmbedCab="yes" />

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="MEDIAFOLDER" Name="EVE Media">
        <Component Id="MediaFolderComponent" Guid="B18DDA95-906F-4578-9F26-EC140C4C02A0" Permanent="yes">
          <CreateFolder Directory="MEDIAFOLDER"/>
          <Shortcut Id="mediaFolderShortcut" Directory="DesktopFolder" Name="EVE Media Folder" Target="[MEDIAFOLDER]" />
          <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
        </Component>
      </Directory>

      <Directory Id="LocalAppDataFolder" Name="LocalAppDataFolder">
        <Directory Id="LocalNetworkOptix" Name="$(env.ORGANIZATION_NAME)">
          <Directory Id="LocalUniversalClient" Name="$(env.APPLICATION_NAME)">
            <Component Id='Settings' Guid='{77C76F04-AC53-4045-9337-B9F513F2D15F}' Permanent='yes'>
              <CreateFolder Directory='LocalUniversalClient'/>
              <File Id='XmlSettings' Name='settings.xml' DiskId='1' Source='../client/resource/settings.xml.tmpl' Vital='yes'/>
              <util:XmlConfig Id='XmlSettings1' Action='create' Value='[MEDIAFOLDER]' Node='value'
                              ElementPath='//settings/config/mediaRoot' File='[LocalUniversalClient]/settings.xml' On='install' Sequence='1' />
            </Component>
          </Directory>
        </Directory>
      </Directory>

      <Directory Id="ProgramFilesFolder">
        <Directory Id="NetworkOptix" Name="$(env.ORGANIZATION_NAME)">
          <Directory Id="INSTALLDIR" Name="$(env.APPLICATION_NAME)">
            <Component Id="MainExecutable" Guid="06DFA703-0266-4970-BAC1-3730BF7D1C66">
              <File Id="UniclientEXE" Name="EvePlayer-Beta.exe" Source="../client/bin/release/client.exe" KeyPath="yes">
                <fire:FirewallException Id="FirewallException" Name="$(env.APPLICATION_NAME)" Scope="any" IgnoreFailure="yes"/>
                
                <Shortcut Id="startmenuUniclient" Directory="ProgramMenuDir" Name="$(env.APPLICATION_NAME)"
                                  WorkingDirectory='INSTALLDIR' Advertise="yes" Icon="icon_menu.exe">
                  <Icon Id="icon_menu.exe" SourceFile="Binary\eve\eve_logo.ico"/>
                </Shortcut>
                <Shortcut Id="desktopUniclient" Directory="DesktopFolder" Name="$(env.APPLICATION_NAME)"
                  WorkingDirectory='INSTALLDIR' Advertise="yes" Icon="icon_desktop.exe">
                  <Icon Id="icon_desktop.exe" SourceFile="Binary\eve\eve_logo.ico"/>
                </Shortcut>
              </File>
            </Component>

            <Component Id="DummyFileAssocationFeatureComponent" Guid="EC44416C-FEE3-41c2-B9D1-BA1B8E85A97B">

              <!--
												Fix ICE18 error. The validator thinks that the install folder
				 								could be empty so we have to use CreateFolder in this component.
				
												http://msdn.microsoft.com/library/en-us/msi/setup/ice18.asp
											-->
              <CreateFolder />
            </Component>

            <Component Id="EveDVDMovie" Guid="547ED48E-70B1-46d0-8331-29812FE44EDC" DiskId="1">
              <RegistryValue Root="HKCR" Type="string" Key="EVE.DVDMovie" Value="EVE DVD movie" KeyPath="yes" />
              <RegistryValue Root="HKCR" Type="string" Key="EVE.DVDMovie\shell\open\command" Value="&quot;[#UniclientEXE]&quot; %1"/>
              <RegistryValue Root="HKCR" Type="string" Key="EVE.DVDMovie\DefaultIcon" Value="&quot;[#UniclientEXE]&quot;" />

              <RegistryValue Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\AutoplayHandlers\EventHandlers\PlayDVDMovieOnArrival" Name="EVEPlayDVDMovieOnArrival" Value=""/>
              <RegistryKey Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\AutoplayHandlers\Handlers\EVEPlayDVDMovieOnArrival">
                <RegistryValue Type="string" Name="Action" Value="Play DVD movie"/>
                <RegistryValue Type="string" Name="DefaultIcon" Value="&quot;[#UniclientEXE]&quot;"/>
                <RegistryValue Type="string" Name="InvokeProgID" Value="EVE.DVDMovie"/>
                <RegistryValue Type="string" Name="InvokeVerb" Value="Open"/>
                <RegistryValue Type="string" Name="Provider" Value="EVE media player"/>
              </RegistryKey>
            </Component>

            <Component Id="EveMovieFiles" Guid="{F192E9DC-D225-4b9f-8A54-0B3502FD2E9E}" DiskId="1">
              <RegistryValue Root="HKCR" Type="string" Key="EVE.MovieFiles" Value="EVE movie files" KeyPath="yes" />
              <RegistryValue Root="HKCR" Type="string" Key="EVE.MovieFiles\shell\open\command" Value="&quot;[#UniclientEXE]&quot; %1"/>
              <RegistryValue Root="HKCR" Type="string" Key="EVE.MovieFiles\DefaultIcon" Value="&quot;[#UniclientEXE]&quot;" />

              <RegistryValue Root="HKLM" Type="string" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\AutoplayHandlers\EventHandlers\PlayVideoFilesOnArrival" Name="EVEPlayVideoFilesOnArrival" Value=""/>
              <RegistryKey Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\AutoplayHandlers\Handlers\EVEPlayVideoFilesOnArrival">
                <RegistryValue Type="string" Name="Action" Value="Play movie files"/>
                <RegistryValue Type="string" Name="DefaultIcon" Value="&quot;[#UniclientEXE]&quot;"/>
                <RegistryValue Type="string" Name="InvokeProgID" Value="EVE.MovieFiles"/>
                <RegistryValue Type="string" Name="InvokeVerb" Value="Open"/>
                <RegistryValue Type="string" Name="Provider" Value="EVE media player"/>
              </RegistryKey>
            </Component>
            
            <Component Id="EveDirectoryPlayWithMenuItem" Guid="{53CE94C5-C287-4bd6-8ABC-D043BFE6D9F9}" DiskId="1">
              <RegistryValue Root="HKCR" Key="Directory\shell\play.EvePlayer.exe" Value="Play with $(env.APPLICATION_NAME)" Type="string" />
              <RegistryValue Root="HKCR" Key="Directory\shell\play.EvePlayer.exe\command" Value="&quot;[#UniclientEXE]&quot; &quot;%1&quot;" Type="string" />
            </Component>

            <!--
              <ProgId Id='EVE.avi' Description='EVE media player file' Icon='UniclientEXE'>
                <Extension Id='avi' ContentType='video/avi'>
                  <Verb Id='open' Command='Open' TargetFile='UniclientEXE' Argument='"%1"'/>
                </Extension>
              </ProgId> -->

            <Component Id="EveApplication" Guid="{F59D1BD6-8B89-4d2a-A9A5-86CB1ECCC633}" DiskId="1">
              <RegistryValue Root="HKCR" Type="string" Key="Applications\EvePlayer-Beta.exe" Name="FriendlyAppName" Value="EVE media player"/>
              <RegistryValue Root="HKCR" Type="string" Key="Applications\EvePlayer-Beta.exe\shell\Open" Value="Play with EVE media player"/>
              <RegistryValue Root="HKCR" Type="string" Key="Applications\EvePlayer-Beta.exe\shell\Open\command" Value="&quot;[#UniclientEXE]&quot; &quot;%1&quot;" />

              <RegistryValue Root="HKLM" Type="string" Key="Software\Clients\Media\EVE media player" Value="EVE media player"/>
              <RegistryValue Root="HKLM" Type="string" Key="Software\Clients\Media\EVE media player\Capabilities" Name="ApplicationName" Value="EVE media player"/>
              <RegistryValue Root="HKLM" Type="string" Key="Software\Clients\Media\EVE media player\Capabilities" Name="ApplicationDescription" Value="Network Optix EVE media player"/>

              <RegistryValue Root="HKLM" Type="string" Key="Software\RegisteredApplications" Name="EVE media player" Value="Software\Clients\Media\EVE media player\Capabilities"/>
            </Component>
            
            <Component Id="FFmpegLibraries" Guid="{5D256521-DE39-4264-A44F-69728AA650EF}">
              <File Id="avcodecDll" Name="avcodec-53.dll" Source="../client/bin/release/avcodec-53.dll"/>
              <File Id="avdeviceDll" Name="avdevice-53.dll" Source="../client/bin/release/avdevice-53.dll"/>
              <File Id="avfilterDll" Name="avfilter-2.dll" Source="../client/bin/release/avfilter-2.dll"/>
              <File Id="avformatDll" Name="avformat-53.dll" Source="../client/bin/release/avformat-53.dll"/>
              <File Id="avutilDll" Name="avutil-51.dll" Source="../client/bin/release/avutil-51.dll"/>
              <File Id="swscaleDll" Name="swscale-2.dll" Source="../client/bin/release/swscale-2.dll"/>
            </Component>

            <Component Id="QTLibraries" Guid="{6BDC7AB9-6230-4cf3-9C1C-634C636D90BC}">
              <File Id="QtCore4.dll" Name="QtCore4.dll" Source="$(env.QTDIR)\bin\QtCore4.dll"/>
              <File Id="QtGui4.dll" Name="QtGui4.dll" Source="$(env.QTDIR)\bin\QtGui4.dll"/>
              <File Id="QtMultimedia4.dll" Name="QtMultimedia4.dll" Source="$(env.QTDIR)\bin\QtMultimedia4.dll"/>
              <File Id="QtNetwork4.dll" Name="QtNetwork4.dll" Source="$(env.QTDIR)\bin\QtNetwork4.dll"/>
              <File Id="QtOpenGL4.dll" Name="QtOpenGL4.dll" Source="$(env.QTDIR)\bin\QtOpenGL4.dll"/>
              <File Id="QtWebKit4.dll" Name="QtWebKit4.dll" Source="$(env.QTDIR)\bin\QtWebKit4.dll"/>
              <File Id="QtXml4.dll" Name="QtXml4.dll" Source="$(env.QTDIR)\bin\QtXml4.dll"/>
              <File Id="QtXmlPatterns4.dll" Name="QtXmlPatterns4.dll" Source="$(env.QTDIR)\bin\QtXmlPatterns4.dll"/>
              <File Id="phonon4.dll" Name="phonon4.dll" Source="$(env.QTDIR)\bin\phonon4.dll"/>
            </Component>

            <Directory Id="imageformats" Name="imageformats">
		            <Component Id="imageformats" Guid="{74793EF7-61C1-4e9c-81D6-A120E85D984F}">
                  <File Id="qgif4.dll" Name="qgif4.dll" Source="$(env.QTDIR)\plugins\imageformats\qgif4.dll"/>
                  <File Id="qjpeg4.dll" Name="qjpeg4.dll" Source="$(env.QTDIR)\plugins\imageformats\qjpeg4.dll"/>
                  <File Id="qtiff4.dll" Name="qtiff4.dll" Source="$(env.QTDIR)\plugins\imageformats\qtiff4.dll"/>
                </Component>
            </Directory>

            <Component Id="OpenAL" Guid="{FA1A8B92-3BEF-4779-90E9-2F76CC9D79D3}">
              <File Id="OpenAL32.dll" Name="OpenAL32.dll" Source="..\client\contrib\openal\bin\Win32\OpenAL32.dll"/>
              <File Id="wrap_oal.dll" Name="wrap_oal.dll" Source="..\client\contrib\openal\bin\Win32\wrap_oal.dll"/>
            </Component>
            
            <Component Id="OpenSSL" Guid="{D7E994B3-B437-4993-A04E-C15AF9DF8312}">
              <File Id="libeay32.dll" Name="libeay32.dll" Source="..\client\contrib\openssl\libeay32.dll"/>
              <File Id="ssleay32.dll" Name="ssleay32.dll" Source="..\client\contrib\openssl\ssleay32.dll"/>
            </Component>

            <Directory Id="styles" Name="styles">
              <Component Id="bespin" Guid="{BF20F7AC-A34C-481a-84E3-731C80050D51}">
                <File Id="bespin.dll" Name="bespin.dll" Source="..\client\contrib\bespin\bin\msvc-x86\release\styles\bespin.dll"/>
              </Component>
            </Directory>

            <Directory Id="arecontvision" Name="arecontvision">
              <Component Id="arecontvision" Guid="{94FE9A39-0F46-4c79-A12F-7FCA2E3B5D16}">
                <File Id="devicesxml" Name="devices.xml" Source="../client/resource/arecontvision/devices.xml"/>
              </Component>
            </Directory>
          </Directory>
          <!-- TODO: Remove the comments around this Component element and the ComponentRef below in order to add resources to this installer. -->
          <!-- <Component Id="ProductComponent" Guid="12bb7788-be4d-4d8d-be8a-1991515340a2"> -->
          <!-- TODO: Insert files, registry keys, and other resources here. -->
          <!-- </Component> -->
        </Directory>
      </Directory>

      <Directory Id="ProgramMenuFolder" Name="Programs">
        <Directory Id="ProgramMenuDir" Name="$(env.ORGANIZATION_NAME)">
          <Component Id="ProgramMenuDir" Guid="{A4C7D09A-756B-45b6-B3A2-1B2D6DCF5D2A}">
            <RemoveFolder Id='ProgramMenuDir' On='uninstall' />
            <RegistryValue Root='HKCU' Key='Software\[Manufacturer]\[ProductName]' Type='string' Value='' KeyPath='yes' />
          </Component>
        </Directory>
      </Directory>

      <Directory Id="DesktopFolder" Name="Desktop"/>
    </Directory>


    <DirectoryRef Id="TARGETDIR">
      <Merge Id="VCRedist1" SourceFile="$(var.commonProgramFiles)Merge Modules\Microsoft_VC90_CRT_x86.msm" DiskId="1" Language="0"/>
      <Merge Id="VCRedist2" SourceFile="$(var.commonProgramFiles)Merge Modules\policy_9_0_Microsoft_VC90_CRT_x86.msm" DiskId="1" Language="0"/>
    </DirectoryRef>

    <Feature Id="VCRedist" Title="Visual C++ 9.0 Runtime" AllowAdvertise="no" Display="hidden" Level="1">
        <MergeRef Id="VCRedist1"/>
        <MergeRef Id="VCRedist2"/>
    </Feature>

    <Feature Id="AppServerFeature" Title="$(env.APPLICATION_NAME) Application Server" Level="1"
       ConfigurableDirectory="INSTALLDIR" Absent="allow" InstallDefault="local" AllowAdvertise="no" Display="expand">
    </Feature>

    <Feature Id="ServerFeature" Title="$(env.APPLICATION_NAME) Media Server" Level="1"
       ConfigurableDirectory="INSTALLDIR" Absent="allow" InstallDefault="local" AllowAdvertise="no" Display="expand">
    </Feature>
    
    <Feature Id="ClientFeature" Title="$(env.APPLICATION_NAME) Client" Level="1"
           ConfigurableDirectory="INSTALLDIR" Absent="allow" InstallDefault="local" AllowAdvertise="no" Display="expand">
      <ComponentRef Id="MainExecutable" />
      <ComponentRef Id="FFmpegLibraries"/>
      <ComponentRef Id="QTLibraries" />
      <ComponentRef Id="imageformats" />
      <ComponentRef Id="OpenAL" />
      <ComponentRef Id="OpenSSL" />
      <ComponentRef Id='ProgramMenuDir' />
      <ComponentRef Id="bespin" />
      <ComponentRef Id='Settings'/>
      <ComponentRef Id='arecontvision'/>
      <ComponentRef Id='MediaFolderComponent'/>

      <ComponentRef Id='EveDirectoryPlayWithMenuItem'/>
      <ComponentRef Id='EveDVDMovie'/>
      <ComponentRef Id='EveMovieFiles'/>

      <ComponentRef Id='EveApplication' />
      
      <!-- Note: The following ComponentGroupRef is required to pull in generated authoring from project references. -->
      <!-- <ComponentGroupRef Id="Product.Generated" /> -->
    </Feature>


    <!--    <FeatureRef Id='EveMediaPlayerFileAssociations' /> -->
    
    <Property Id="WIXUI_INSTALLDIR" Value="INSTALLDIR" />
    <Property Id="WIXUI_MEDIAFOLDER" Value="MEDIAFOLDER" />

    <UIRef Id="WixUI_Common" />

    <!--<UIRef Id="WixUI_InstallDir" />-->
    <UIRef Id="WixUI_ErrorProgressText" />

    <!--<UI>
      <Publish Dialog="BrowseDlg" Control="PathEdit" Property="_BrowseProperty" Value="MediaDir"/>
    </UI>-->

    <UI>
      <Property Id="DefaultUIFont" Value="WixUI_Font_Normal" />
      <TextStyle Id="WixUI_Font_Normal" FaceName="Tahoma" Size="8" />
      <TextStyle Id="WixUI_Font_Bigger" FaceName="Tahoma" Size="12" />
      <TextStyle Id="WixUI_Font_Title" FaceName="Tahoma" Size="9" Bold="yes" />

      <Property Id="ARPNOMODIFY" Value="1" />

      <DialogRef Id="FeaturesDlg" />
      <DialogRef Id="BrowseDlg" />
      <DialogRef Id="DiskCostDlg" />
      <DialogRef Id="ErrorDlg" />
      <DialogRef Id="FatalError" />
      <DialogRef Id="FilesInUse" />
      <DialogRef Id="MsiRMFilesInUse" />
      <DialogRef Id="PrepareDlg" />
      <DialogRef Id="ProgressDlg" />
      <DialogRef Id="ResumeDlg" />
      <DialogRef Id="UserExit" />
      <!--Width="260" Height="85"-->
      <Dialog Id="DowngradeWarningDlg" Width="370" Height="270" Title="[ProductName] Setup" NoMinimize="no">
        <!--<Control Id="No" Type="PushButton" X="132" Y="57" Width="56" Height="17"
          Default="yes" Text="No">
          <Publish Event="EndDialog" Value="Exit">1</Publish>
        </Control>
        <Control Id="Yes" Type="PushButton" X="72" Y="57" Width="56" Height="17" Text="Yes" Cancel="yes">
          <Publish Event="EndDialog" Value="Return">1</Publish>
        </Control>-->

        <Control Id="Next" Type="PushButton" X="236" Y="243" Width="56" Height="17" Default="yes" Text="!(loc.WixUINext)" >
          <Publish Event="EndDialog" Value="Exit">1</Publish>
        </Control>

        <Control Id="Back" Type="PushButton" X="180" Y="243" Width="56" Height="17" Text="!(loc.WixUIBack)" />
        <Control Id="Cancel" Type="PushButton" X="304" Y="243" Width="56" Height="17" Cancel="yes" Text="!(loc.WixUICancel)">
          <Publish Event="SpawnDialog" Value="CancelDlg">1</Publish>
        </Control>

        <!--<Control Id="Text" Type="Text" X="48" Y="15" Width="194" Height="30">
          <Text>A later version of [ProductName] is already installed. Are you sure you want to continue installation?</Text>
        </Control>-->

        <!--<Control Id="Icon" Type="Icon" X="15" Y="15" Width="24" Height="24"
          ToolTip="Warning" FixedSize="yes" IconSize="32" Text="Warning"/>-->

        <Control Id="Description" Type="Text" X="25" Y="23" Width="280" Height="15" Transparent="yes" NoPrefix="yes" Text="A later version of [ProductName] is already installed." />
        <!--<Control Id="Title" Type="Text" X="15" Y="6" Width="200" Height="15" Transparent="yes" NoPrefix="yes" Text="WARNING" />-->
        <Control Id="BannerBitmap" Type="Icon" X="344" Y="10" TabSkip="no" Text="Warning" Width="24" Height="24"/>
        <Control Id="BannerLine" Type="Line" X="0" Y="44" Width="370" Height="0" />
        <Control Id="BottomLine" Type="Line" X="0" Y="234" Width="370" Height="0" />
      </Dialog>

      <Binary Id="Warning" SourceFile="Binary\Exclam.ico" />

      <DialogRef Id="MediaDirDlg" />

      <Publish Dialog="ExitDialog" Control="Finish" Event="EndDialog" Value="Return" Order="999">1</Publish>
      <Publish Dialog="ExitDialog" Control="Finish" Order="1" Event="DoAction" Value="StartAppOnExit">WIXUI_EXITDIALOGOPTIONALCHECKBOX</Publish>

      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="LicenseAgreementDlg">NOT NEWERFOUND</Publish>
      <Publish Dialog="WelcomeDlg" Control="Next" Event="NewDialog" Value="DowngradeWarningDlg">NEWERFOUND</Publish>

      <Publish Dialog="DowngradeWarningDlg" Control="Next" Event="NewDialog" Value="LicenseAgreementDlg">1</Publish>
      <Publish Dialog="DowngradeWarningDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg">1</Publish>

      <Publish Dialog="LicenseAgreementDlg" Control="Back" Event="NewDialog" Value="WelcomeDlg">NOT NEWERFOUND</Publish>
      <Publish Dialog="LicenseAgreementDlg" Control="Back" Event="NewDialog" Value="DowngradeWarningDlg">NEWERFOUND</Publish>

      <Publish Dialog="LicenseAgreementDlg" Control="Next" Event="NewDialog" Value="InstallDirDlg">LicenseAccepted = "1"</Publish>

      <Publish Dialog="InstallDirDlg" Control="Back" Event="NewDialog" Value="LicenseAgreementDlg">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="Next" Event="SetTargetPath" Value="[WIXUI_INSTALLDIR]" Order="1">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="Next" Event="NewDialog" Value="MediaDirDlg" Order="2">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="ChangeFolder" Property="_BrowseProperty" Value="[WIXUI_INSTALLDIR]" Order="1">1</Publish>
      <Publish Dialog="InstallDirDlg" Control="ChangeFolder" Event="SpawnDialog" Value="BrowseDlg" Order="2">1</Publish>

      <Publish Dialog="MediaDirDlg" Control="Back" Event="NewDialog" Value="InstallDirDlg">1</Publish>
      <Publish Dialog="MediaDirDlg" Control="Next" Event="SetTargetPath" Value="[WIXUI_MEDIAFOLDER]" Order="1">1</Publish>
      <Publish Dialog="MediaDirDlg" Control="Next" Event="NewDialog" Value="FeaturesDlg" Order="2">1</Publish>
      <Publish Dialog="MediaDirDlg" Control="ChangeFolder" Property="_BrowseProperty" Value="[WIXUI_MEDIAFOLDER]" Order="1">1</Publish>
      <Publish Dialog="MediaDirDlg" Control="ChangeFolder" Event="SpawnDialog" Value="BrowseDlg" Order="2">1</Publish>

      <Publish Dialog="FeaturesDlg" Control="Back" Event="NewDialog" Value="MediaDirDlg">1</Publish>
      <Publish Dialog="FeaturesDlg" Control="Next" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>

      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MediaDirDlg" Order="1">NOT Installed</Publish>
      <Publish Dialog="VerifyReadyDlg" Control="Back" Event="NewDialog" Value="MaintenanceTypeDlg" Order="2">Installed</Publish>

      <Publish Dialog="MaintenanceWelcomeDlg" Control="Next" Event="NewDialog" Value="MaintenanceTypeDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="RepairButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="RemoveButton" Event="NewDialog" Value="VerifyReadyDlg">1</Publish>
      <Publish Dialog="MaintenanceTypeDlg" Control="Back" Event="NewDialog" Value="MaintenanceWelcomeDlg">1</Publish>
    </UI>
  </Product>
</Wix>
