<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
	<parent>
		<artifactId>hdwitness</artifactId>
		<groupId>com.networkoptix.hdwitness</groupId>
		<version>2.3.0-SNAPSHOT</version>
		<relativePath>..</relativePath>
	</parent>

	<groupId>com.networkoptix.hdwitness</groupId>
	<version>2.3.0-SNAPSHOT</version>
	<modelVersion>4.0.0</modelVersion>
	<artifactId>wixsetup</artifactId>
	<packaging>pom</packaging>
	<name>HD Witness Installer</name>

	<properties>
        <product.title>${wixsetup.name}</product.title>
		<root.dir>${basedir}/..</root.dir>
		<skip.test>true</skip.test>
		<skip.compress>true</skip.compress>
		<DbSync22Dir>${libdir}/${arch}/share/dbsync-2.2</DbSync22Dir>
	</properties>

	<build>
        <finalName>${installer.name}-${release.version}.${buildNumber}-${arch}-${build.configuration}-${install.type}-beta</finalName>
		<directory>${arch}</directory>
		<sourceDirectory>${basedir}</sourceDirectory>
		<plugins>
			<plugin>
				<artifactId>maven-clean-plugin</artifactId>
				<version>2.5</version>
				<executions>
					<execution>
						<id>auto-clean</id>
						<phase>initialize</phase>
						<goals>
							<goal>clean</goal>
						</goals>
						<configuration>
							<skip>${clean-skip}</skip>
						</configuration>
					</execution>
				</executions>
			</plugin>        
			<plugin>
				<groupId>org.apache.maven.plugins</groupId>
				<artifactId>maven-resources-plugin</artifactId>
				<version>2.6</version>
				<executions>
					<execution>
						<id>copy-project-resources</id>
						<phase>generate-sources</phase>
						<goals>
							<goal>copy-resources</goal>
						</goals>
						<configuration>
							<outputDirectory>${project.build.directory}</outputDirectory>
							<resources>          
								<resource>
									<directory>${root.dir}/wixsetup/maven/bin-resources</directory>
									<filtering>false</filtering>
								</resource>
								<resource>
									<directory>${root.dir}/wixsetup/maven/bin-resources</directory>
									<filtering>false</filtering>
								</resource>                                  
								<resource>
									<directory>${root.dir}/wixsetup/maven/filter-resources</directory>
									<filtering>true</filtering>
								</resource>	                                
								<resource>
									<directory>${parent.customization.dir}/wixsetup</directory>
									<filtering>false</filtering>
								</resource>		                
								<resource>
									<directory>${customization.dir}/wixsetup</directory>
									<filtering>false</filtering>
								</resource>                             
							</resources>              
							<encoding>UTF-8</encoding>
						</configuration>            
					</execution>
				</executions>
			</plugin>	
			<plugin>
				<groupId>com.google.code.maven-replacer-plugin</groupId>
				<artifactId>replacer</artifactId>
				<version>1.5.2</version>
				<executions>
					<execution>
						<phase>generate-sources</phase>
						<goals>
							<goal>replace</goal>
						</goals>
						<configuration>
							<encoding>utf-8</encoding>
							<file>${project.build.directory}/CustomActions/CustomActions-${arch}.vcxproj</file>
							<!-- <excludes>
										<exclude>**/vmaxproxy-x64.vcproj</exclude>
									</excludes> -->	
							<ignoreMissingFile>true</ignoreMissingFile>                                    
							<replacements>
								<replacement>
									<token>
										<![CDATA[<PlatformToolset>v110</PlatformToolset>]]></token>
									<value>
										<![CDATA[<PlatformToolSet>${PlatformToolSet}</PlatformToolSet>]]></value>
								</replacement>           
							</replacements>
						</configuration>								
					</execution>
				</executions>
			</plugin>                     

			<plugin>
				<groupId>org.codehaus.mojo</groupId>
				<artifactId>exec-maven-plugin</artifactId>
				<version>1.1.1</version>
				<executions>

					<execution>
						<id>package-CustomActions-with-msbuild</id>
						<phase>process-sources</phase>
						<goals>
							<goal>exec</goal>
						</goals>
						<configuration>
							<executable>${project.build.directory}/build.bat</executable>
							<workingDirectory>${project.build.directory}/CustomActions/</workingDirectory>      
						</configuration>
					</execution>

					<execution>
						<id>wix-gen</id>
						<phase>generate-resources</phase>
						<goals>
							<goal>exec</goal>
						</goals>
						<configuration>
							<executable>${init.python.dir}/python</executable>
							<arguments>
								<argument>wix-gen.py</argument>
							</arguments>
							<workingDirectory>${project.build.directory}</workingDirectory>
						</configuration>                    
					</execution>

					<execution>
						<id>wix-compile</id>
						<phase>prepare-package</phase>
						<goals>
							<goal>exec</goal>
						</goals>
						<configuration>
							<executable>${init.python.dir}/python</executable>
							<arguments>
                                <argument>wix-compile-${install.type}.py</argument>
							</arguments>
							<workingDirectory>${project.build.directory}</workingDirectory>
						</configuration>                    
					</execution>                   

					<execution>
						<id>wix-sign</id>
						<phase>package</phase>
						<goals>
							<goal>exec</goal>
						</goals>
						<configuration>
							<executable>${project.build.directory}/sign.bat</executable>
							<workingDirectory>${project.build.directory}</workingDirectory>
							<skip>${skip.sign}</skip>
						</configuration>
					</execution>        

					<execution>
						<id>integration-test</id>
						<phase>integration-test</phase>
						<goals>
							<goal>exec</goal>
						</goals>
						<configuration>
							<executable>${project.build.directory}/test.bat</executable>
							<workingDirectory>${project.build.directory}</workingDirectory>
							<skip>${skip.test}</skip>                        
						</configuration>    
					</execution>
				</executions>
			</plugin>           			
		</plugins>
	</build>       
</project>