<project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/maven-v4_0_0.xsd">
    <!--
    Example pom for delegating maven goals to msbuild so it builds the "solution"
 
    A solution can be a group of projects, but here we only have one.
    It should also be possible to have one maven project per solution project, 
    and have a parent pom to deletegate the build.
  -->
    <parent>
        <artifactId>hdwitness</artifactId>
        <groupId>com.networkoptix.hdwitness</groupId>
        <version>1.3.0</version>
        <relativePath>..</relativePath>
    </parent>

    <groupId>com.networkoptix.hdwitness</groupId>
    <version>1.3.0</version>
    <modelVersion>4.0.0</modelVersion>
    <artifactId>wixsetup</artifactId>
    <packaging>pom</packaging>
    <name>HD Witness Installer</name>

    <properties>
        <arch>x86</arch>
        <skip.test>true</skip.test>
        <skip.compress>true</skip.compress>
    </properties>

    <build>
        <directory>${arch}</directory>
        <sourceDirectory>${basedir}</sourceDirectory>
        <finalName>${project.parent.artifactId}-${release.version}.${buildNumber}-${platform}-${arch}-${build.configuration}-${customization}</finalName>
        <plugins>
            <plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>properties-maven-plugin</artifactId>
                <version>1.0-alpha-2</version>
                <executions>
                    <execution>
                        <phase>validate</phase>
                        <goals>
                            <goal>read-project-properties</goal>
                        </goals>
                        <configuration>
                            <files>
                                <file>../build-${customization}.properties</file>
                                <file>../build-environment/${arch}/libdir.properties</file>
                                <file>../appserver/setup/build/appserver.properties</file>
                            </files>
                        </configuration>
                    </execution>
                </executions>
            </plugin>
        </plugins>
    </build>

    <profiles>
        <profile>
            <id>installer</id>
            <activation>                
                <activeByDefault>true</activeByDefault>
            </activation>           
            <build>
                <plugins>
                    <plugin>
                        <groupId>org.apache.maven.plugins</groupId>
                        <artifactId>maven-resources-plugin</artifactId>
                        <version>2.5</version>

                        <executions>
                            <execution>
                                <id>prepare-resources</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>copy-resources</goal>
                                </goals>
                                <configuration>
                                    <outputDirectory>${project.build.directory}</outputDirectory>
                                    <resources>
                                        <resource>
                                            <directory>${project.build.sourceDirectory}/maven-bin-resources/common</directory>
                                            <filtering>false</filtering>
                                        </resource>     
                                        <resource>
                                            <directory>${project.build.sourceDirectory}/maven-bin-resources/custom/${installer.customization}</directory>
                                            <filtering>false</filtering>
                                        </resource>     
                                        <resource>
                                            <directory>${project.build.sourceDirectory}</directory>
                                            <filtering>false</filtering>
                                            <includes>
                                                <include>CustomActions/**</include>
                                            </includes>
                                        </resource>                                         
                                    </resources>            
                                    <encoding>UTF-8</encoding>
                                </configuration>            
                            </execution>
                        </executions>
                    </plugin>       

                    <plugin>
                        <artifactId>maven-antrun-plugin</artifactId>
                        <version>1.7</version>
                        <executions>
                            <execution>
                                <id>compress</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>run</goal>
                                </goals>
                                <configuration>
                                    <target>
                                        <exec dir="${libdir}/bin/${build.configuration}" executable="${project.build.directory}/pack.bat" failifexecutionfails="true" />
                                    </target>
                                    <skip>${skip.compress}</skip>
                                </configuration>
                            </execution>    
                        </executions>
                    </plugin>                       

                    <plugin>
                        <groupId>org.codehaus.mojo</groupId>
                        <artifactId>exec-maven-plugin</artifactId>
                        <version>1.1.1</version>
                        <executions>
                            <execution>
                                <id>wix-heat</id>
                                <phase>process-sources</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>python</executable>
                                    <arguments>
                                        <argument>generate-ec-wxs.py</argument>
                                    </arguments>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                </configuration>                    
                            </execution>

                            <execution>
                                <id>package-CustomActions-with-msbuild</id>
                                <phase>generate-resources</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>${project.build.directory}/build.bat</executable>
                                    <workingDirectory>${project.build.directory}/CustomActions/</workingDirectory>      
                                </configuration>
                            </execution>

                            <execution>
                                <id>wix-candle</id>
                                <phase>process-resources</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>candle</executable>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <arguments>
                                        <argument>-dAppServerSourceDir="${AppServerDir}"</argument>
                                        <argument>-arch</argument>
                                        <argument>${arch}</argument>
                                        <argument>-out</argument>
                                        <argument>obj\${build.configuration}\</argument>
                                        <argument>-ext</argument> 
                                        <argument>WixFirewallExtension.dll</argument>
                                        <argument>-ext</argument> 
                                        <argument>WixUIExtension.dll</argument>
                                        <argument>-ext</argument> 
                                        <argument>WixUtilExtension.dll</argument>
                                        <argument>-ext</argument> 
                                        <argument>wixext\WixSystemToolsExtension.dll</argument>
                                        <argument>UninstallOptionsDlg.wxs</argument> 
                                        <argument>Associations.wxs</argument>
                                        <argument>PasswordShouldMatchDlg.wxs</argument>
                                        <argument>UpgradeDlg.wxs</argument> 
                                        <argument>PasswordDlg.wxs</argument>
                                        <argument>EmptyPasswordDlg.wxs</argument>
                                        <argument>AllFieldsAreMandatoryDlg.wxs</argument>
                                        <argument>InstallTypeDlg.wxs</argument>
                                        <argument>AdvancedTypeDlg.wxs</argument>
                                        <argument>PortDuplicateDlg.wxs</argument>
                                        <argument>PortIsBusyDlg.wxs</argument>
                                        <argument>InvalidPasswordDlg.wxs</argument>
                                        <argument>MediaDirDlg.wxs</argument>
                                        <argument>MediaServerDlg.wxs</argument>
                                        <argument>MyFeaturesDlg.wxs</argument>
                                        <argument>SelectionWarning.wxs</argument>
                                        <argument>DowngradeWarningDlg.wxs</argument>
                                        <argument>Product.wxs</argument>
                                        <argument>AppServerFiles.wxs</argument>
                                        <argument>AppServerDlg.wxs</argument> 
                                    </arguments>
                                </configuration>                    
                            </execution>

                            <execution>
                                <id>wix-light</id>
                                <phase>compile</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>light</executable>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <arguments>
                                        <argument>-cultures:en-US</argument>
                                        <argument>-loc</argument>
                                        <argument>CustomStrings.wxl</argument>
                                        <argument>-ext</argument>
                                        <argument>WixFirewallExtension.dll</argument>
                                        <argument>-ext</argument>
                                        <argument>WixUIExtension.dll</argument>
                                        <argument>-ext</argument>
                                        <argument>WixUtilExtension.dll</argument>
                                        <argument>-ext</argument> 
                                        <argument>wixext\WixSystemToolsExtension.dll</argument>
                                        <argument>-out</argument>
                                        <argument>bin/${project.build.finalName}.msi</argument> 
                                        <argument>-pdbout</argument> 
                                        <argument>bin\${build.configuration}\EVEMediaPlayerSetup.wixpdb</argument> 
                                        <argument>obj\${build.configuration}\*.wixobj"</argument>
                                    </arguments>
                                    <successCodes>
                                        <successCode>0</successCode>
                                        <successCode>204</successCode>
                                    </successCodes> 
                                </configuration>                    
                            </execution>

                            <execution>
                                <id>wix-fix</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>cscript</executable>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <arguments>
                                        <argument>FixExitDialog.js</argument>
                                        <argument>bin/${project.build.finalName}.msi</argument>
                                    </arguments>                            
                                </configuration>
                            </execution>

                            <!--<execution>
                                <id>wix-pack-exe</id>
                                <phase>prepare-package</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>setupbld</executable>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <arguments>
                                        <argument>-out</argument>
                                        <argument>bin/${project.build.finalName}.exe</argument>
                                        <argument>-ms</argument>
                                        <argument>bin/${project.build.finalName}.msi</argument>
                                        <argument>-setup</argument>
                                        <argument>setup.exe</argument>
                                    </arguments>        
                                </configuration>                    
                            </execution>    -->             

                            <execution>
                                <id>integration-test</id>
                                <phase>integration-test</phase>
                                <goals>
                                    <goal>exec</goal>
                                </goals>
                                <configuration>
                                    <executable>${project.build.directory}/test.bat</executable>
                                    <workingDirectory>${project.build.directory}</workingDirectory>
                                    <skip>${skip.test}</skip>                        
                                </configuration>    
                            </execution>
                        </executions> 
                    </plugin>
                    <!--<plugin>
                <groupId>org.codehaus.mojo</groupId>
                <artifactId>build-helper-maven-plugin</artifactId>
                <version>1.3</version>
                <executions>
                    <execution>
                        <id>attach</id>
                        <phase>package</phase>
                        <goals>
                            <goal>attach-artifact</goal>
                        </goals>
                        <configuration>
                            <artifacts>
                                <artifact>
                                    <file>${basedir}/bin/${msbuild.configuration}/${pom.parent.artifact}-${release.version}.exe</file>
                                    <type>exe</type>
                                    <classifier>${platform}-x86-${msbuild.configuration}</classifier>
                                </artifact>
                            </artifacts>
                        </configuration>
                    </execution>
                </executions>
            </plugin> -->
                </plugins>
            </build>
        </profile>
    </profiles>
</project>