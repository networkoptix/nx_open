# Create metadata_sdk.zip at Generation phase.
# Build included sample(s) via included build_sample.sh/.bat at Build phase.

# Receive variable values from the calling CMakeList.txt.
set(CMAKE_CURRENT_BINARY_DIR @CMAKE_CURRENT_BINARY_DIR@)
set(CMAKE_SOURCE_DIR @CMAKE_SOURCE_DIR@)
set(PYTHON_EXECUTABLE @PYTHON_EXECUTABLE@)
set(sdk_src_static_origin @sdk_src_static_origin@)
set(sdk_src_static_files @sdk_src_static_files@)
set(sdk_src_nx_kit_origin @sdk_src_nx_kit_origin@)
set(sdk_src_nx_kit_files @sdk_src_nx_kit_files@)
set(sdk_src_nx_sdk_origin @sdk_src_nx_sdk_origin@)
set(sdk_src_nx_sdk_files @sdk_src_nx_sdk_files@)

set(sdk_src_nx_sdk_new_origin @sdk_src_nx_sdk_new_origin@)
set(sdk_src_nx_sdk_new_files @sdk_src_nx_sdk_new_files@)
set(sdk_src_nx_sdk_common_headers_origin @sdk_src_nx_sdk_common_headers_origin@)
set(sdk_src_nx_sdk_common_headers @sdk_src_nx_sdk_common_headers@)

set(sdk_src_sample_origin @sdk_src_sample_origin@)
set(sdk_src_sample_files @sdk_src_sample_files@)
set(sdk_src_sample_ut_origin @sdk_src_sample_ut_origin@)
set(sdk_src_sample_ut_files @sdk_src_sample_ut_files@)

set(sdk_name @sdk_name@)

include(${CMAKE_SOURCE_DIR}/cmake/utils.cmake)

set(target_dir ${CMAKE_CURRENT_BINARY_DIR}/${sdk_name})

nx_copy_always(${sdk_src_static_origin} "${sdk_src_static_files}" ${target_dir})
nx_copy_always(${sdk_src_nx_kit_origin} "${sdk_src_nx_kit_files}" ${target_dir}/nx_kit)

# Replace copyright notice in nx_kit: remove LGPL reference.
file(GLOB_RECURSE nx_kit_files ${target_dir}/nx_kit/*)
foreach(file ${nx_kit_files})
    execute_process(COMMAND ${PYTHON_EXECUTABLE}
        ${CMAKE_SOURCE_DIR}/build_utils/replace_in_file.py
            --source-string " Licensed under GNU Lesser General Public License version 3."
            --replacement-string ""
            ${file}
    )
endforeach()

nx_copy_always(${sdk_src_nx_sdk_new_origin} "${sdk_src_nx_sdk_new_files}" ${target_dir}/src/nx)
nx_copy_always(${sdk_src_nx_sdk_common_headers_origin} "${sdk_src_nx_sdk_common_headers}"
    ${target_dir}/src/plugins)
nx_copy_always(${sdk_src_sample_origin} "${sdk_src_sample_files}"
    ${target_dir}/samples/stub_metadata_plugin/src)
nx_copy_always(${sdk_src_sample_ut_origin} "${sdk_src_sample_ut_files}"
    ${target_dir}/samples/stub_metadata_plugin/unit_tests/src)
