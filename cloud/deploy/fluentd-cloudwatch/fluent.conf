<source>
  @type forward
  port 24224
  bind 0.0.0.0
</source>

<filter *>
  @type record_transformer
  enable_ruby true
  <record>
    log_group_name ${ENV.fetch("INSTANCE_NAME", "unknown_instance")}-${tag}
    log_stream_name ${tag}
  </record>
</filter>

<filter *>
  @type stdout
  format single_value
  message_key log
</filter>

<match *>
  @type copy
  <store>
    @type cloudwatch_logs
    log_group_name_key log_group_name
    log_stream_name_key log_stream_name
    auto_create_stream true
    put_log_events_retry_limit 20
    message_keys log
  </store>
</match>




