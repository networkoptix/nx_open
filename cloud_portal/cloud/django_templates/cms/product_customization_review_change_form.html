{% extends "admin/change_form.html" %}
{% load i18n admin_urls static admin_modify %}
{% load cms_filters %}
{% block content %}
    <div class="module custom-block">
        <div>
            {% for context_name, records in contexts.items %}
            <div style="margin-bottom: 20px">
                <div>{{ context_name }}</div>
                <div class="table-responsive">
                    <table class="table table-condensed">
                        <thead>
                            <tr>
                                <td><strong>Field</strong></td>
                                <td><strong>Changed Value</strong></td>
                            </tr>
                        </thead>
                        <tbody>
                            {%  for record in records %}
                            <tr>
                                {% with data_structure=record.data_structure language=record.language %}
                                    {% get_datastructure_type data_structure as data_structure_type %}
                                    <td>{% if data_structure.label %}
                                        {{ data_structure.label }}:
                                    {% else %}
                                        {{ data_structure.name }}
                                    {% endif %}

                                    {% if language %}
                                        ({{ language.code }})
                                    {% endif %}
                                    </td>
                                    <td>
                                        {% if data_structure_type == "Image" %}
                                            <div><img class="preview-image review-preview" src="data:image/png;base64,{{ record }}"></div>
                                        {% elif data_structure_type == "File" %}
                                            <a href="{% url 'download_file' data_structure.name %}?version_id={{ version.id }}&lang={{ language.code }}&draft"
                                               download>Download</a>
                                        {% else %}
                                            <div class="show-html" style="border: none">{{ record|safe }}</div>
                                        {% endif %}
                                    </td>
                                {% endwith %}
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
    {{ block.super }}
{% endblock %}
