# -*- coding: utf-8 -*-
# Generated by Django 1.10.2 on 2018-09-11 19:45
from __future__ import unicode_literals

from django.db import connection, migrations


def convert_apps_to_utf8mb(apps, schema_editor):
    tables = []
    tables.extend([model._meta.db_table for model in apps.get_app_config('api').get_models()])
    tables.extend([model._meta.db_table for model in apps.get_app_config('cms').get_models()])
    tables.extend([model._meta.db_table for model in apps.get_app_config('notifications').get_models()])

    with connection.cursor() as cursor:
        cursor.execute('ALTER DATABASE cloudportal CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;')
        for table in tables:
            cursor.execute('ALTER TABLE {} CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;'.format(table))


class Migration(migrations.Migration):

    dependencies = [
        ('cms', '0035_auto_20180821_0209'),
        ('notifications', '0009_cloudnotification_customizations')
    ]

    operations = [
        migrations.RunPython(convert_apps_to_utf8mb),
    ]
